<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.project.Smallbox.mapper.MyPageMapper">

	<!-- 회원별 찜 목록 조회-->
	<!-- 1. WHERE절로 각 회원별 찜 목록을 조회
	     2. movie 테이블의 movie_idx와 movie_like 테이블의 movie_idx을 
	        조인해 movie 테이블에서 필요한 컬럼 조회 -->
	<select id="selectLikeList" resultType="com.project.Smallbox.vo.MovieVO">
		SELECT movie.movie_idx, movie_picture, movie_title 
			FROM movie 
			JOIN movie_like ON movie.movie_idx = movie_like.movie_idx 
			WHERE member_id = #{member_id}
			LIMIT #{startRow}, #{movieLimit}
	</select>

    <!-- 각 회원이 찜한 영화 수 조회 -->
	<select id="selectLikeMovieCount" resultType="int">
		SELECT Count(*) 
			FROM movie_like 
			WHERE member_id = #{member_id}
	</select>
	
	<!-- 회원별 리뷰 목록 조회 -->
	<select id="selectReviewList" resultType="com.project.Smallbox.vo.PosterVO">
		SELECT * 
			FROM poster 
			WHERE member_id = #{member_id}
			ORDER BY comment_date
			LIMIT #{startRow}, #{commentLimit}
	</select>
	
	<!-- 각 회원이 작성한 전체 리뷰 수 조회 -->
	<select id="selectCommentListCount" resultType="int">
		SELECT COUNT(*) 
			FROM comment 
			WHERE member_id = #{member_id}
	</select>
	
	<!-- 회원별 리뷰 삭제 -->
	<delete id="deleteComment">
		DELETE 
			FROM comment 
			WHERE comment_idx = #{comment_idx}
	</delete>
	
	<!-- 회원별 쿠폰 목록 조회 -->
	<select id="selectMemberCouponList" resultType="com.project.Smallbox.vo.CouponVO">
		SELECT * 
			FROM coupon 
			WHERE member_id = #{member_id}
			ORDER BY coupon_date DESC
			LIMIT #{startRow}, #{couponLimit}
	</select>
	
	<!-- 각 회원이 가진 전체 쿠폰 수 조회 -->
	<select id="selectMemberCouponCount" resultType="int">
		SELECT Count(*) 
			FROM coupon 
			WHERE member_id = #{member_id}
	</select>
	
	<!-- 마이페이지 메인 정보 조회 -->
	<select id="selectMypageInfo" resultType="com.project.Smallbox.vo.MypageVO">
		SELECT m.member_id, m.member_email, coupon.cp_count, comment.cm_count, movie_like.ml_count
		FROM member m
			 ,(SELECT COUNT(coupon_idx) cp_count FROM coupon WHERE member_id = #{member_id}) coupon
   			 ,(SELECT COUNT(comment_idx) cm_count FROM comment WHERE member_id = #{member_id}) comment
    		 ,(SELECT COUNT(movie_idx) ml_count FROM movie_like WHERE member_id = #{member_id}) movie_like
    	WHERE member_id = #{member_id}
	</select>
	
</mapper>
